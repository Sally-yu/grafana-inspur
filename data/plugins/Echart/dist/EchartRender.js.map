{"version":3,"sources":["../src/EchartRender.js"],"names":["link","scope","elem","attrs","ctrl","container","find","events","on","render","renderingCompleted","codetText","panel","code","chartMode","ChartMode","tableMode","TableMode","decimal","postion","position","orient","axis","data","lastData","allData","legend","forEach","serie","lastPoint","length","rows","lastValue","_","isArray","parseFloat","toFixed","lastTime","push","columns","text","echarts","registerTheme","dark","map","init","console","log","JSON","stringify","datapoints","target","valueList","timeList","tempValue","tempTime","kv","Date","toLocaleString","pieSer","value","name","lineSer","barSer","areaStyle","values","i","type","stack","label","normal","show","showLabel","barStack","barLabel","optionPie","title","subtext","x","tooltip","trigger","formatter","left","selected","series","radius","asRing","center","itemStyle","emphasis","shadowBlur","shadowOffsetX","shadowColor","avoidLabelOverlap","textStyle","fontSize","fontWeight","optionLine","color","axisPointer","backgroundColor","grid","right","bottom","containLabel","toolbox","feature","saveAsImage","xAxis","boundaryGap","yAxis","optionRadar","radar","indicator","max","optionMap","optionBar","json","test","match","replace","eval","optionCus","option","temp","clear","setOption","opts","width","height","silent","resize","$"],"mappings":"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","file":"EchartRender.js","sourcesContent":["import echarts from './lib/echarts.min';\r\nimport _ from 'lodash';\r\nimport dark from './lib/dark';\r\nimport $ from 'jquery';\r\n\r\nexport default function link(scope, elem, attrs, ctrl, ) {\r\n    const container = elem.find('.echarts-panel');\r\n    ctrl.events.on('render', () => {\r\n        render();\r\n        ctrl.renderingCompleted();\r\n    });\r\n\r\n\r\n    function render() {\r\n        var codetText = ctrl.panel.code;\r\n        const chartMode = ctrl.panel.ChartMode;//echarts图类型，线饼雷达等\r\n        const tableMode = ctrl.panel.TableMode;//数据表格式，时序或table\r\n        const decimal = ctrl.panel.decimal;//保留小数位\r\n        const postion = ctrl.panel.position;//饼图legend位置\r\n        const orient = ctrl.panel.orient;//饼图legend方向\\\r\n        const axis = ctrl.panel.axis;//x-y方向\r\n\r\n        if (!ctrl.data) return;\r\n\r\n        var lastData = [];//最后时刻数据\r\n        var allData = [];//全部value time [[[v,t],[v,t],[v,t]...],[[v,t],[v,t],[v,t]...]]\r\n        var legend = [];//每个查询名称\r\n\r\n        //时序数据库取出的表 设置结果为table型\r\n        if (tableMode == 'table') {\r\n            ctrl.data.forEach((serie) => {\r\n                var lastPoint;\r\n                if (serie[serie.length - 2]) {\r\n                    lastPoint = serie.rows[serie.rows.length - 2];//数据较多时最后一点经常取不到数据\r\n                } else {\r\n                    lastPoint = serie.rows[serie.rows.length - 1];\r\n                }\r\n                var lastValue;\r\n                if (decimal >= 0 && decimal < 20) {\r\n                    lastValue = _.isArray(lastPoint) ? parseFloat(parseFloat(lastPoint[1]).toFixed(decimal)) : null; //最后时刻value\r\n                } else {\r\n                    lastValue = _.isArray(lastPoint) ? lastPoint[1] : null; //最后时刻value\r\n                }\r\n                const lastTime = lastPoint[0]; //最后时刻time\r\n\r\n                lastData.push({ \"value\": lastValue == null ? 100 : lastValue, \"time\": lastTime, \"name\": serie.columns[1].text }); //每个serie装一对值和时间\r\n\r\n                legend.push(serie.columns[1].text);\r\n                allData.push(serie.rows);\r\n            });\r\n        }\r\n\r\n        // console.log('dark:'+JSON.stringify(dark));//json格式，当变量写入到js文件中读取，\r\n\r\n        echarts.registerTheme('dark', dark);\r\n        ctrl.map = echarts.init(container[0], 'dark');//使用echart官方主题\r\n\r\n        console.log('ctrl.data:' + JSON.stringify(ctrl.data));\r\n\r\n        //在Echart_Ctrl的data，\r\n        // console.log('code:'+codetText);\r\n        // console.log('chartMode:'+chartMode);\r\n        // console.log('**************'+JSON.stringify(ctrl.data));//传入ctrl的datalist 查询到的所有数据\r\n\r\n        //处理查询数据库得到的数据\r\n        if (tableMode == 'time' && ctrl.data.length > 0) {\r\n            ctrl.data.forEach((serie) => {\r\n                const lastPoint = serie.datapoints[serie.datapoints.length - 1];  //最后时刻点[value,time]\r\n                var lastValue;\r\n                if (decimal >= 0 && decimal < 20) {\r\n                    lastValue = _.isArray(lastPoint) ? parseFloat(parseFloat(lastPoint[0]).toFixed(decimal)) : null; //最后时刻value\r\n                } else {\r\n                    lastValue = _.isArray(lastPoint) ? lastPoint[0] : null; //最后时刻value\r\n                }\r\n\r\n                const lastTime = _.isArray(lastPoint) ? lastPoint[1] : null; //最后时刻time\r\n\r\n                const target = serie.target;//查询的名称，查询页面可设置\r\n\r\n                lastData.push({ \"value\": lastValue == null ? 100 : lastValue, \"time\": lastTime, \"name\": target }); //每个serie装一对值和时间\r\n                legend.push(target);\r\n                allData.push(serie.datapoints);//每个查询一个数组\r\n            });\r\n        }\r\n\r\n        var valueList = [];//每个查询的值\r\n        var timeList = [];//每个查询的时刻\r\n\r\n        //装到值数组和时间数组\r\n        allData.forEach((serie) => {\r\n            const tempValue = [];\r\n            const tempTime = [];\r\n\r\n            serie.forEach((kv) => {\r\n                tempTime.push(new Date(kv[1]).toLocaleString());\r\n                if (decimal >= 0 && decimal < 20) {\r\n                    if (tableMode == 'time') {\r\n                        tempValue.push(parseFloat(parseFloat(kv[0]).toFixed(decimal)));\r\n                    }\r\n                    else if (tableMode == 'table') {\r\n                        tempValue.push(parseFloat(parseFloat(kv[1]).toFixed(decimal)));\r\n                    }\r\n                } else {\r\n                    if (tableMode == 'time') {\r\n                        tempValue.push(kv[0]);\r\n                    } else if (tableMode == 'table') {\r\n                        tempValue.push(kv[1]);\r\n                    }\r\n                }\r\n            });\r\n            valueList.push(tempValue);\r\n            timeList.push(tempTime);\r\n        });\r\n\r\n        console.log('lastdata:' + JSON.stringify(lastData));\r\n        console.log('legend:' + JSON.stringify(legend));\r\n        console.log('valueList:' + JSON.stringify(valueList));\r\n        console.log('timeList:' + JSON.stringify(timeList));\r\n\r\n        var pieSer = [];//饼图series中的data\r\n        lastData.forEach((data) => {\r\n            pieSer.push({\r\n                value: data['value'],\r\n                name: data['name']\r\n            });\r\n        });\r\n\r\n        var lineSer = [];//折线用的series\r\n        var barSer = [];//柱形图用的series\r\n        var areaStyle = ctrl.panel.areaStyle.values ? {} : null;\r\n        for (var i = 0; i < legend.length; i++) {\r\n            //折线图\r\n            lineSer.push({\r\n                name: legend[i],\r\n                type: 'line',\r\n                stack: '',\r\n                data: valueList[i],\r\n                areaStyle: areaStyle,//颜色填充\r\n                label: {                     //数值标签\r\n                    normal: {\r\n                        show: ctrl.panel.showLabel.values,\r\n                        position: 'top'\r\n                    }\r\n                },\r\n            });\r\n\r\n            //柱形图\r\n            barSer.push({\r\n                name: legend[i],\r\n                type: 'bar',\r\n                stack: ctrl.panel.barStack.values ? '总量' : '',//堆叠求和\r\n                data: valueList[i],\r\n                areaStyle: areaStyle,//颜色填充\r\n                label: {\r\n                    normal: {\r\n                        show: ctrl.panel.barLabel.values,  //显示数值\r\n                        position: 'insideRight' //label在色块中的 位置\r\n                    }\r\n                },\r\n            });\r\n\r\n        }\r\n\r\n\r\n\r\n\r\n        //饼图\r\n        var optionPie = {\r\n            title: {\r\n                text: '',\r\n                subtext: '',\r\n                x: 'center'\r\n            },\r\n            tooltip: {\r\n                trigger: 'item',\r\n                formatter: \"{a} <br/>{b} : {c} ({d}%)\"\r\n            },\r\n            legend: {\r\n                type: 'scroll',\r\n                orient: orient,\r\n                left: postion,\r\n                data: legend,\r\n\r\n                selected: legend\r\n            },\r\n            series: [\r\n                {\r\n                    name: '占用',\r\n                    type: 'pie',\r\n                    radius: ctrl.panel.asRing.values ? ['50%', '70%'] : '50%',  //饼图或环形图\r\n                    center: ['50%', '50%'],\r\n                    data: pieSer,\r\n                    itemStyle: {\r\n                        emphasis: {\r\n                            shadowBlur: 10,\r\n                            shadowOffsetX: 0,\r\n                            shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n                        }\r\n                    },\r\n                    avoidLabelOverlap: false,\r\n                    label: {\r\n                        normal: {\r\n                            show:!ctrl.panel.asRing.values ,\r\n                            position: ctrl.panel.asRing.values ?'center':'',\r\n                        },\r\n                        emphasis: {\r\n                            show: true,\r\n                            textStyle: {\r\n                                fontSize: '30',\r\n                                fontWeight: 'bold'\r\n                            }\r\n                        }\r\n                    },\r\n                }\r\n            ]\r\n        };\r\n\r\n        //折线图\r\n        var optionLine = {\r\n            title: {\r\n                text: '',\r\n                textStyle: {\r\n                    color: '#ccc'\r\n                }\r\n            },\r\n            tooltip: {\r\n                trigger: 'axis',\r\n                axisPointer: {\r\n                    type: 'cross',\r\n                    label: {\r\n                        backgroundColor: '#6a7985'\r\n                    }\r\n                }\r\n            },\r\n            legend: {\r\n                data: legend,\r\n                orient: orient,\r\n                left: postion,\r\n            },\r\n            grid: {\r\n                left: '3%',\r\n                right: '4%',\r\n                bottom: '3%',\r\n                containLabel: true\r\n            },\r\n            toolbox: {\r\n                feature: {\r\n                    saveAsImage: {}\r\n                }\r\n            },\r\n            xAxis: {\r\n                type: 'category',\r\n                boundaryGap: false,\r\n                data: timeList[0]\r\n            },\r\n            yAxis: {\r\n                type: 'value'\r\n            },\r\n            series: lineSer\r\n        };\r\n\r\n        //雷达图\r\n        var optionRadar = {\r\n            title: {\r\n                text: ''\r\n            },\r\n            tooltip: {\r\n                trigger: 'axis'\r\n            },\r\n            legend: {\r\n                x: 'right',\r\n                data: ['某软件', '某主食手机', '某水果手机', '某国产手机'],\r\n                orient: orient,\r\n                left: postion,\r\n\r\n            },\r\n\r\n            //底环\r\n            radar: [\r\n                {\r\n                    indicator: [\r\n                        { text: '品牌', max: 100 },\r\n                        { text: '内容', max: 100 },\r\n                        { text: '可用性', max: 100 },\r\n                        { text: '功能', max: 100 },\r\n                        { text: '创新', max: 100 }\r\n                    ],\r\n                    center: ['50%', '50%'],\r\n                    radius: 120\r\n\r\n                },\r\n            ],\r\n\r\n\r\n            //数据\r\n            series: [\r\n                {\r\n                    type: 'radar',\r\n                    tooltip: {\r\n                        trigger: 'item'\r\n                    },\r\n                    itemStyle: { normal: { areaStyle: { type: 'default' } } },\r\n                    data: [\r\n                        {\r\n                            value: [60, 73, 85, 60, 39],\r\n                            name: '某软件'\r\n                        }\r\n                    ]\r\n                },\r\n            ]\r\n        };\r\n\r\n        var optionMap = {\r\n\r\n        }\r\n\r\n        //柱状图\r\n        var optionBar = {\r\n            tooltip: {\r\n                trigger: 'axis',\r\n                axisPointer: {            // 坐标轴指示器，坐标轴触发有效\r\n                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'\r\n                }\r\n            },\r\n            legend: {\r\n                data: legend,\r\n                orient: orient,\r\n                left: postion,\r\n            },\r\n            grid: {\r\n                left: '3%',\r\n                right: '4%',\r\n                bottom: '3%',\r\n                containLabel: true\r\n            },\r\n            yAxis: {\r\n                type: 'value'  //\r\n            },\r\n            xAxis: {\r\n                type: 'category',\r\n                data: timeList[0],\r\n            },\r\n            series: barSer,\r\n        }\r\n\r\n        var json = {};\r\n        if (codetText != null && codetText != '') {\r\n            console.log(codetText);//{   keyName : 34, 'keyCode' : '5554'}\r\n            console.log(/(?:\\s*['\"]*)?([a-zA-Z0-9]+)(?:['\"]*\\s*)?:/g.test(codetText))//true\r\n            console.log(codetText.match(/(?:\\s*['\"]*)?([a-zA-Z0-9]+)(?:['\"]*\\s*)?:/g));//[\"   keyName :\", \" 'keyCode' :\"]\r\n            codetText = codetText.replace(/(?:\\s*['\"]*)?([a-zA-Z0-9]+)(?:['\"]*\\s*)?:/g, \"'$1':\");\r\n            console.log(codetText);//{'keyName': 34,'keyCode': '5554'}\r\n            json = eval('(' + codetText + ')');\r\n            console.log(json);//Object {keyName: 34, keyCode: \"5554\"}\r\n        }\r\n\r\n        //自定义代码\r\n        var optionCus = codetText ? json : null;\r\n\r\n        //选图表类型，页面上可选 editor.tml中\r\n        let option = {};\r\n        switch (chartMode) {\r\n            case 'line':\r\n                option = optionLine;\r\n                if (axis == 'x for value') {//设置xy方向\r\n                    var temp = option.xAxis;\r\n                    option.xAxis = option.yAxis;\r\n                    option.yAxis = temp;\r\n                }\r\n                break;\r\n            case 'pie':\r\n                option = optionPie;\r\n                break;\r\n            case 'radar':\r\n                option = optionRadar;\r\n                break;\r\n            case 'map':\r\n                option = optionMap;\r\n                break;\r\n            case 'bar':\r\n                option = optionBar;\r\n                if (axis == 'x for value') {\r\n                    var temp = option.xAxis;\r\n                    option.xAxis = option.yAxis;\r\n                    option.yAxis = temp;\r\n                }\r\n                break;\r\n\r\n            case 'custom'://自定义的内容，按照编写的json格式\r\n                option = optionCus;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n\r\n\r\n        //清除原图表以刷新\r\n        ctrl.map.clear();\r\n        ctrl.map.setOption(option);\r\n\r\n        var opts = {\r\n            width: 'auto',\r\n            height: ctrl.height,\r\n            silent: false\r\n        }\r\n\r\n        ctrl.map.resize(opts);\r\n\r\n\r\n        /*\r\n        if (ctrl.mapCenterMoved) ctrl.map.panToMapCenter();\r\n    \r\n        if (!ctrl.map.legend && ctrl.panel.showLegend) ctrl.map.createLegend();\r\n    \r\n        ctrl.map.drawCircles();\r\n        */\r\n\r\n    }\r\n}"]}